---
title: "Clustering presequences"
author: "Katarzyna Sidorczuk"
date: "24/01/2022"
output: 
  html_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width = 14, fig.height = 10, warning = FALSE, message = FALSE)

library(dplyr)
library(biogram)
library(seqR)
library(ggbiplot)
library(ggrepel)
library(cluster)
library(factoextra)
library(tsne)
library(umap)
library(DT)
library(tidyr)
library(ggplot2)
library(ggdendro)
library(grid)
library(gridExtra)
library(targets)
library(plotly)

set.seed(73607254)

my_DT <- function(x, ...)
  datatable(x, ..., escape = FALSE, extensions = 'Buttons', filter = "top", rownames = FALSE,
            style = "bootstrap")

options(DT.options = list(dom = "Brtip",
                          buttons = c("copy", "csv", "excel", "print"),
                          pageLength = 50
))

add_group <- function(df) {
  mutate(df,
         group = case_when(dataset %in% c("Amyloids combined", "AmyPro regions", "CPAD peptides") ~ "Amyloids",
                           dataset %in% c("cTP experimentally verified location", "cTP experimentally verified presequence") ~ "cTP",
                           dataset %in% c("cTP-mTP experimentally verified location", "cTP-mTP experimentally verified presequence") ~ "cTP-mTP",
                           dataset %in% c("mTP experimentally verified location", "mTP experimentally verified presequence") ~ "mTP",
                           dataset == "SP experimentally verified presequence" ~ "SP",
                           dataset %in% c("DBAASP AMP", "DBAASP AMP max 100 aa") ~ "AMP",
                           dataset %in% c("TM regions experimentally verified - alpha", "TM regions experimentally verified - beta") ~ "Transmembrane")) 
}

source("functions/extract_features.R")

colors <- c("Amyloids combined" = "#bb45e4", "AmyPro regions" = "#e44496", "CPAD peptides" = "#8d44e4", 
            "cTP experimentally verified location" = "#528313", "cTP-mTP experimentally verified location" = "#837713", 
            "cTP-mTP experimentally verified presequence" ="#e4d345", "cTP experimentally verified presequence" = "#9de444", 
            "DBAASP AMP" = "#831313", "DBAASP AMP max 100 aa" = "#e44444", "mTP experimentally verified location" = "#834813", 
            "mTP experimentally verified presequence" = "#e49144", "SP experimentally verified presequence" = "#45e495", 
            "TM regions experimentally verified - alpha" = "#44aee4", "TM regions experimentally verified - beta" = "#4451e4")

prop_list <- c("BIGC670101", "CHAM820101", "CHOP780201", "CHOP780202", "CHOP780203",
               "FAUJ880103", "KLEP840101", "KYTJ820101", "ZIMJ680103")

tar_load(c(datasets_list, datasets_list_cdhit))
datasets <- unlist(sapply(names(datasets_list_cdhit), function(i) rep(i, length(datasets_list_cdhit[[i]])), USE.NAMES = FALSE))
```

## Data exploration

Numbers of sequences in each data set
```{r}
ds_len <- lengths(datasets_list) %>% 
  data.frame() %>% 
  setNames("Number of sequences")
ds_len_cdhit <- lengths(datasets_list_cdhit) %>% 
  data.frame() %>% 
  setNames("After CD-HIT 70%")
knitr::kable(cbind(ds_len, ds_len_cdhit))
```

Amino acid composition of whole datasets
```{r}
aa_comp_datasets <- lapply(names(datasets_list_cdhit), function(i) {
  aa <- unlist(datasets_list_cdhit[[i]], use.names = FALSE)
  as.data.frame(table(aa)/length(aa)) %>% 
    mutate(dataset = i)
}) %>% bind_rows()

aa_comp_datasets %>% 
  add_group() %>% 
  ggplot(aes(x = aa, y = Freq, fill = dataset)) +
  geom_col(position = "dodge") +
  facet_wrap(~group) +
  theme_bw() +
  scale_fill_manual("Data set", values = colors) 

ggplot(aa_comp_datasets, aes(x = dataset, y = Freq, fill = dataset)) +
  geom_col() +
  facet_wrap(~aa) +
  theme_bw() +
  scale_fill_manual("Data set", values = colors) +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank()) 
```

PCA on amino acid composition
```{r}
pca_data_all <- aa_comp_datasets %>% 
  pivot_wider(names_from = aa, values_from = Freq, values_fill = 0) 

pca_res_all <- prcomp(pca_data_all[, 2:ncol(pca_data_all)], center = TRUE, scale = TRUE)

ggbiplot(pca_res_all, choices = 1:2) +
  theme_bw() +
  geom_point(aes(color = pca_data_all[["dataset"]]), size = 3) +
  geom_text_repel(label = pca_data_all[["dataset"]]) +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual("Data set", values = colors) +
  theme(legend.position = "none")
```

PCA on physicochemical properties
```{r}
props <- lapply(seq_along(datasets_list_cdhit), function(i) {
  as.data.frame(calculate_properties(datasets_list_cdhit[[i]], prop_list))
}) %>% do.call(rbind, .)

pca_res_props_all <- prcomp(props, center = TRUE, scale = TRUE)

ggbiplot(pca_res_props_all, choices = 1:2, alpha = 0.25, ellipse = TRUE, groups = datasets) +
  theme_bw() +
  #  geom_point(aes(color = datasets), alpha = 0.5) +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual("Data set", values = colors)

pca_res_props_all[["x"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = datasets) %>% 
  add_group() %>% 
  ggplot(aes(x = PC1, y = PC2, color = dataset)) +
  geom_point(alpha = 0.5) +
  scale_color_manual("Data set", values = colors) +
  facet_wrap(~group) + 
  theme_bw()
```

Based on these results:
- I exclude DBAASP AMP from further analyses as its properties are represented well by sequences with maximum length of 100 aa
- I exclude presequences with experimentally verified location as they do not differ much from experimentally verified presequences
- two amyloid datasets show differences, so the analyses will be performed with amyloids combined or separate groups


```{r}
datasets_list_amyloids_both <- datasets_list_cdhit[c("AmyPro regions", "CPAD peptides", "cTP-mTP experimentally verified presequence", 
                                                     "cTP experimentally verified presequence", "DBAASP AMP max 100 aa", 
                                                     "mTP experimentally verified presequence", "SP experimentally verified presequence", 
                                                     "TM regions experimentally verified - alpha", "TM regions experimentally verified - beta")]
datasets_list_amyloids_combined <- datasets_list_cdhit[c("Amyloids combined", "cTP-mTP experimentally verified presequence", 
                                                         "cTP experimentally verified presequence", "DBAASP AMP max 100 aa", 
                                                         "mTP experimentally verified presequence", "SP experimentally verified presequence", 
                                                         "TM regions experimentally verified - alpha", "TM regions experimentally verified - beta")]

filtered_datasets_amyloids_both <- unlist(sapply(names(datasets_list_amyloids_both), function(i) rep(i, length(datasets_list_amyloids_both[[i]])), USE.NAMES = FALSE))
filtered_datasets_amyloids_combined <- unlist(sapply(names(datasets_list_amyloids_combined), function(i) rep(i, length(datasets_list_amyloids_combined[[i]])), USE.NAMES = FALSE))
```

## Amino acid composition of peptides

```{r}
aa_comp_peptides1 <- calculate_aa_comp_peptides(datasets_list_amyloids_both)

aa_comp_peptides1_clust_data <- aa_comp_peptides1 %>% 
  pivot_wider(names_from = `Amino acid`, values_from = `Frequency`) %>% 
  select(-c(dataset, prot)) 

aa_comp_peptides2 <- calculate_aa_comp_peptides(datasets_list_amyloids_combined)

aa_comp_peptides2_clust_data <- aa_comp_peptides2 %>% 
  pivot_wider(names_from = `Amino acid`, values_from = `Frequency`) %>% 
  select(-c(dataset, prot)) 
```

### PCA
```{r}
pca_aa_res1 <- prcomp(aa_comp_peptides1_clust_data, center = TRUE, scale = TRUE)

ggbiplot(pca_aa_res1, choices = 1:2, alpha = 0.25, ellipse = TRUE, groups = filtered_datasets_amyloids_both) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual("Data set", values = colors)

ggbiplot(pca_aa_res1, choices = 1:2, alpha = 0.25, ellipse = TRUE, groups = filtered_datasets_amyloids_both) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position = "none") +
  scale_color_manual("Data set", values = colors) +
  facet_wrap(~groups, ncol = 5)
```

```{r}
pca_aa_res2 <- prcomp(aa_comp_peptides2_clust_data, center = TRUE, scale = TRUE)

ggbiplot(pca_aa_res2, choices = 1:2, alpha = 0.25, ellipse = TRUE, groups = filtered_datasets_amyloids_combined) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual("Data set", values = colors)

ggbiplot(pca_aa_res2, choices = 1:2, alpha = 0.25, ellipse = TRUE, groups = filtered_datasets_amyloids_combined) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position = "none") +
  scale_color_manual("Data set", values = colors) +
  facet_wrap(~groups, ncol = 5)
```

### t-SNE
Perplexity = 10
```{r}
tsne_aa_res1 <- tsne(aa_comp_peptides1_clust_data, k = 2, perplexity = 10, max_iter = 1000)
mutate(as.data.frame(tsne_aa_res1), dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

tsne_aa_res2 <- tsne(aa_comp_peptides2_clust_data, k = 2, perplexity = 10, max_iter = 1000)
mutate(as.data.frame(tsne_aa_res2), dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Perplexity = 15
```{r}
tsne_aa_res1 <- tsne(aa_comp_peptides1_clust_data, k = 2, perplexity = 15, max_iter = 1000)
mutate(as.data.frame(tsne_aa_res1), dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

tsne_aa_res2 <- tsne(aa_comp_peptides2_clust_data, k = 2, perplexity = 15, max_iter = 1000)
mutate(as.data.frame(tsne_aa_res2), dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Perplexity = 30
```{r}
tsne_aa_res1 <- tsne(aa_comp_peptides1_clust_data, k = 2, perplexity = 30, max_iter = 1000)
mutate(as.data.frame(tsne_aa_res1), dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

tsne_aa_res2 <- tsne(aa_comp_peptides2_clust_data, k = 2, perplexity = 30, max_iter = 1000)
mutate(as.data.frame(tsne_aa_res2), dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Perplexity = 15, k = 5
```{r}
tsne_aa_res1 <- tsne(aa_comp_peptides1_clust_data, k = 5, perplexity = 15, max_iter = 1000)
mutate(as.data.frame(tsne_aa_res1), dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

tsne_aa_res2 <- tsne(aa_comp_peptides2_clust_data, k = 5, perplexity = 15, max_iter = 1000)
mutate(as.data.frame(tsne_aa_res2), dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

### UMAP

Neighbors = 15, spread = 2, min_dist = 0.5
```{r}
umap_config <- umap.defaults
umap_config[["random_state"]] <- 73607254
umap_config[["spread"]] <- 2
umap_config[["min_dist"]] <- 0.5

umap_res1 <- umap(aa_comp_peptides1_clust_data, config = umap_config)
umap_res1[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

umap_res2 <- umap(aa_comp_peptides2_clust_data, config = umap_config)
umap_res2[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Neighbors = 15, spread = 5, min_dist = 0.5
```{r}
umap_config <- umap.defaults
umap_config[["random_state"]] <- 73607254
umap_config[["spread"]] <- 5
umap_config[["min_dist"]] <- 0.5

umap_res1 <- umap(aa_comp_peptides1_clust_data, config = umap_config)
umap_res1[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

umap_res2 <- umap(aa_comp_peptides2_clust_data, config = umap_config)
umap_res2[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Neighbors = 30, spread = 2, min_dist = 0.5
```{r}
umap_config <- umap.defaults
umap_config[["random_state"]] <- 73607254
umap_config[["spread"]] <- 2
umap_config[["min_dist"]] <- 0.5
umap_config[["n_neighbors"]] <- 30

umap_res1 <- umap(aa_comp_peptides1_clust_data, config = umap_config)
umap_res1[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

umap_res2 <- umap(aa_comp_peptides2_clust_data, config = umap_config)
umap_res2[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Neighbors = 50, spread = 2, min_dist = 0.5
```{r}
umap_config <- umap.defaults
umap_config[["random_state"]] <- 73607254
umap_config[["spread"]] <- 2
umap_config[["min_dist"]] <- 0.5
umap_config[["n_neighbors"]] <- 50

umap_res1 <- umap(aa_comp_peptides1_clust_data, config = umap_config)
umap_res1[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

umap_res2 <- umap(aa_comp_peptides2_clust_data, config = umap_config)
umap_res2[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```


## Physicochemical properties

```{r}
props_amyloids_both <- props %>% 
  mutate(dataset = datasets) %>% 
  filter(dataset %in% c("AmyPro regions", "CPAD peptides", "cTP-mTP experimentally verified presequence", 
                        "cTP experimentally verified presequence", "DBAASP AMP max 100 aa", 
                        "mTP experimentally verified presequence", "SP experimentally verified presequence", 
                        "TM regions experimentally verified - alpha", "TM regions experimentally verified - beta")) %>% 
  select(-dataset)

props_amyloids_combined <- props %>% 
  mutate(dataset = datasets) %>% 
  filter(dataset %in% c("Amyloids combined", "cTP-mTP experimentally verified presequence", 
                        "cTP experimentally verified presequence", "DBAASP AMP max 100 aa", 
                        "mTP experimentally verified presequence", "SP experimentally verified presequence", 
                        "TM regions experimentally verified - alpha", "TM regions experimentally verified - beta")) %>% 
  select(-dataset)
```

### PCA
```{r}
pca_props_res1 <- prcomp(props_amyloids_both, center = TRUE, scale = TRUE)

ggbiplot(pca_props_res1, choices = 1:2, alpha = 0.25, ellipse = TRUE, groups = filtered_datasets_amyloids_both) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual("Data set", values = colors)

ggbiplot(pca_props_res1, choices = 1:2, alpha = 0.25, ellipse = TRUE, groups = filtered_datasets_amyloids_both) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position = "none") +
  scale_color_manual("Data set", values = colors) +
  facet_wrap(~groups, ncol = 5)
```

```{r}
pca_props_res2 <- prcomp(props_amyloids_combined, center = TRUE, scale = TRUE)

ggbiplot(pca_props_res2, choices = 1:2, alpha = 0.25, ellipse = TRUE, groups = filtered_datasets_amyloids_combined) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual("Data set", values = colors)

ggbiplot(pca_props_res2, choices = 1:2, alpha = 0.25, ellipse = TRUE, groups = filtered_datasets_amyloids_combined) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position = "none") +
  scale_color_manual("Data set", values = colors) +
  facet_wrap(~groups, ncol = 5)
```

### t-SNE
Perplexity = 10
```{r}
tsne_props_res1 <- tsne(props_amyloids_both, k = 2, perplexity = 10, max_iter = 1000)
mutate(as.data.frame(tsne_props_res1), dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

tsne_props_res2 <- tsne(props_amyloids_combined, k = 2, perplexity = 10, max_iter = 1000)
mutate(as.data.frame(tsne_props_res2), dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Perplexity = 15
```{r}
tsne_props_res1 <- tsne(props_amyloids_both, k = 2, perplexity = 15, max_iter = 1000)
mutate(as.data.frame(tsne_props_res1), dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

tsne_props_res2 <- tsne(props_amyloids_combined, k = 2, perplexity = 15, max_iter = 1000)
mutate(as.data.frame(tsne_props_res2), dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Perplexity = 30
```{r}
tsne_props_res1 <- tsne(props_amyloids_both, k = 2, perplexity = 30, max_iter = 1000)
mutate(as.data.frame(tsne_props_res1), dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

tsne_props_res2 <- tsne(props_amyloids_combined, k = 2, perplexity = 30, max_iter = 1000)
mutate(as.data.frame(tsne_props_res2), dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Perplexity = 15, k = 5
```{r}
tsne_props_res1 <- tsne(props_amyloids_both, k = 5, perplexity = 15, max_iter = 1000)
mutate(as.data.frame(tsne_props_res1), dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

tsne_props_res2 <- tsne(props_amyloids_combined, k = 5, perplexity = 15, max_iter = 1000)
mutate(as.data.frame(tsne_props_res2), dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

### UMAP

Neighbors = 15, spread = 2, min_dist = 0.5
```{r}
umap_config <- umap.defaults
umap_config[["random_state"]] <- 73607254
umap_config[["spread"]] <- 2
umap_config[["min_dist"]] <- 0.5

umap_res1 <- umap(props_amyloids_both, config = umap_config)
umap_res1[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

umap_res2 <- umap(props_amyloids_combined, config = umap_config)
umap_res2[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Neighbors = 15, spread = 1, min_dist = 0.5
```{r}
umap_config <- umap.defaults
umap_config[["random_state"]] <- 73607254
umap_config[["spread"]] <- 1
umap_config[["min_dist"]] <- 0.5

umap_res1 <- umap(props_amyloids_both, config = umap_config)
umap_res1[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

umap_res2 <- umap(props_amyloids_combined, config = umap_config)
umap_res2[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Neighbors = 30, spread = 1, min_dist = 0.5
```{r}
umap_config <- umap.defaults
umap_config[["random_state"]] <- 73607254
umap_config[["spread"]] <- 1
umap_config[["min_dist"]] <- 0.5
umap_config[["n_neighbors"]] <- 30

umap_res1 <- umap(props_amyloids_both, config = umap_config)
umap_res1[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

umap_res2 <- umap(props_amyloids_combined, config = umap_config)
umap_res2[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Neighbors = 50, spread = 1, min_dist = 0.5
```{r}
umap_config <- umap.defaults
umap_config[["random_state"]] <- 73607254
umap_config[["spread"]] <- 1
umap_config[["min_dist"]] <- 0.5
umap_config[["n_neighbors"]] <- 50

umap_res1 <- umap(props_amyloids_both, config = umap_config)
umap_res1[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

umap_res2 <- umap(props_amyloids_combined, config = umap_config)
umap_res2[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```


## Bigrams

```{r}
bigrams_amyloids_both <- lapply(names(datasets_list_amyloids_both), function(i) {
  calculate_binary_ngram_matrix(datasets_list_amyloids_both[[i]],
                                c(2, 2),
                                list(NULL, 1))
}) %>% bind_rows()
bigrams_amyloids_both[is.na(bigrams_amyloids_both)] <- 0

bigrams_amyloids_combined <- lapply(names(datasets_list_amyloids_combined), function(i) {
  calculate_binary_ngram_matrix(datasets_list_amyloids_combined[[i]],
                                c(2, 2),
                                list(NULL, 1))
}) %>% bind_rows()
bigrams_amyloids_combined[is.na(bigrams_amyloids_combined)] <- 0
```

### PCA
```{r}
pca_bigram_res1 <- prcomp(bigrams_amyloids_both, center = TRUE, scale = TRUE)

ggbiplot(pca_bigram_res1, choices = 1:2, groups = filtered_datasets_amyloids_both, var.axes = FALSE) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual("Data set", values = colors) +
  theme(legend.position = "none")

pca_bigram_res1[["x"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = PC1, y = PC2, color = dataset)) +
  geom_point(alpha = 0.5) +
  scale_color_manual("Data set", values = colors) +
  theme_bw()
pca_bigram_res1[["x"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = PC1, y = PC2, color = dataset)) +
  geom_point(alpha = 0.5) +
  facet_wrap(~dataset) +
  scale_color_manual("Data set", values = colors) +
  theme_bw() +
  theme(legend.position = "none")

pca_bigram_res2 <- prcomp(bigrams_amyloids_combined, center = TRUE, scale = TRUE)

ggbiplot(pca_bigram_res2, choices = 1:2, groups = filtered_datasets_amyloids_combined, var.axes = FALSE) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual("Data set", values = colors) +
  theme(legend.position = "none")

pca_bigram_res2[["x"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = PC1, y = PC2, color = dataset)) +
  geom_point(alpha = 0.5) +
  scale_color_manual("Data set", values = colors) +
  theme_bw()
pca_bigram_res2[["x"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = PC1, y = PC2, color = dataset)) +
  geom_point(alpha = 0.5) +
  facet_wrap(~dataset) +
  scale_color_manual("Data set", values = colors) +
  theme_bw() +
  theme(legend.position = "none")
```

### t-SNE
Perplexity = 10
```{r}
tsne_bigrams_res1 <- tsne(bigrams_amyloids_both, k = 2, perplexity = 10, max_iter = 1000)
mutate(as.data.frame(tsne_bigrams_res1), dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

tsne_bigrams_res2 <- tsne(bigrams_amyloids_combined, k = 2, perplexity = 10, max_iter = 1000)
mutate(as.data.frame(tsne_bigrams_res2), dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Perplexity = 15
```{r}
tsne_bigrams_res1 <- tsne(bigrams_amyloids_both, k = 2, perplexity = 15, max_iter = 1000)
mutate(as.data.frame(tsne_bigrams_res1), dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

tsne_bigrams_res2 <- tsne(bigrams_amyloids_combined, k = 2, perplexity = 15, max_iter = 1000)
mutate(as.data.frame(tsne_bigrams_res2), dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Perplexity = 30
```{r}
tsne_bigrams_res1 <- tsne(bigrams_amyloids_both, k = 2, perplexity = 30, max_iter = 1000)
mutate(as.data.frame(tsne_bigrams_res1), dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

tsne_bigrams_res2 <- tsne(bigrams_amyloids_combined, k = 2, perplexity = 30, max_iter = 1000)
mutate(as.data.frame(tsne_bigrams_res2), dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Perplexity = 15, k = 5
```{r}
tsne_bigrams_res1 <- tsne(bigrams_amyloids_both, k = 5, perplexity = 15, max_iter = 1000)
mutate(as.data.frame(tsne_bigrams_res1), dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

tsne_bigrams_res2 <- tsne(bigrams_amyloids_combined, k = 5, perplexity = 15, max_iter = 1000)
mutate(as.data.frame(tsne_bigrams_res2), dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

### UMAP

Neighbors = 15, spread = 2, min_dist = 0.5
```{r}
umap_config <- umap.defaults
umap_config[["random_state"]] <- 73607254
umap_config[["spread"]] <- 2
umap_config[["min_dist"]] <- 0.5

umap_res1 <- umap(bigrams_amyloids_both, config = umap_config)
umap_res1[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

umap_res2 <- umap(bigrams_amyloids_combined, config = umap_config)
umap_res2[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Neighbors = 15, spread = 1, min_dist = 0.5
```{r}
umap_config <- umap.defaults
umap_config[["random_state"]] <- 73607254
umap_config[["spread"]] <- 1
umap_config[["min_dist"]] <- 0.5

umap_res1 <- umap(bigrams_amyloids_both, config = umap_config)
umap_res1[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

umap_res1[["layout"]] %>% 
            as.data.frame() %>% 
            mutate(dataset = filtered_datasets_amyloids_both,
                   name = unlist(sapply(names(datasets_list_amyloids_both), function(i) names(datasets_list_amyloids_both[[i]]), USE.NAMES = FALSE))) %>% 
    plot_ly(x = ~V1, y = ~V2, color = ~dataset, colors = colors, text = ~name, hoverinfo = "text")

umap_res2 <- umap(bigrams_amyloids_combined, config = umap_config)
umap_res2[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Neighbors = 30, spread = 1, min_dist = 0.5
```{r}
umap_config <- umap.defaults
umap_config[["random_state"]] <- 73607254
umap_config[["spread"]] <- 1
umap_config[["min_dist"]] <- 0.5
umap_config[["n_neighbors"]] <- 30

umap_res1 <- umap(bigrams_amyloids_both, config = umap_config)
umap_res1[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

umap_res2 <- umap(bigrams_amyloids_combined, config = umap_config)
umap_res2[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Neighbors = 50, spread = 1, min_dist = 0.5
```{r}
umap_config <- umap.defaults
umap_config[["random_state"]] <- 73607254
umap_config[["spread"]] <- 1
umap_config[["min_dist"]] <- 0.5
umap_config[["n_neighbors"]] <- 50

umap_res1 <- umap(bigrams_amyloids_both, config = umap_config)
umap_res1[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

umap_res2 <- umap(bigrams_amyloids_combined, config = umap_config)
umap_res2[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

## Trigrams

```{r}
trigrams_amyloids_both <- lapply(names(datasets_list_amyloids_both), function(i) {
  calculate_binary_ngram_matrix(datasets_list_amyloids_both[[i]],
                                c(3, 3, 3, 3),
                                list(c(0, 0), c(1, 0), c(0, 1), c(1, 1)))
}) %>% bind_rows()
trigrams_amyloids_both[is.na(trigrams_amyloids_both)] <- 0

trigrams_amyloids_combined <- lapply(names(datasets_list_amyloids_combined), function(i) {
  calculate_binary_ngram_matrix(datasets_list_amyloids_combined[[i]],
                                c(2, 2),
                                list(NULL, 1))
}) %>% bind_rows()
trigrams_amyloids_combined[is.na(trigrams_amyloids_combined)] <- 0
```

### PCA
```{r}
pca_trigram_res1 <- prcomp(trigrams_amyloids_both[vapply(trigrams_amyloids_both, function(x) length(unique(x)) > 1, logical(1L))], 
                           center = TRUE, scale = TRUE)

ggbiplot(pca_trigram_res1, choices = 1:2, groups = filtered_datasets_amyloids_both, var.axes = FALSE) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual("Data set", values = colors) +
  theme(legend.position = "none")

pca_trigram_res1[["x"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = PC1, y = PC2, color = dataset)) +
  geom_point(alpha = 0.5) +
  scale_color_manual("Data set", values = colors) +
  theme_bw()

pca_trigram_res1[["x"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both,
         name = unlist(sapply(names(datasets_list_amyloids_both), function(i) names(datasets_list_amyloids_both[[i]]), USE.NAMES = FALSE))) %>% 
    plot_ly(x = ~PC1, y = ~PC2, color = ~dataset, colors = colors, text = ~name, hoverinfo = "text")

pca_trigram_res1[["x"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = PC1, y = PC2, color = dataset)) +
  geom_point(alpha = 0.5) +
  facet_wrap(~dataset) +
  scale_color_manual("Data set", values = colors) +
  theme_bw() +
  theme(legend.position = "none")

pca_trigram_res2 <- prcomp(trigrams_amyloids_combined, center = TRUE, scale = TRUE)

ggbiplot(pca_trigram_res2, choices = 1:2, groups = filtered_datasets_amyloids_combined, var.axes = FALSE) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual("Data set", values = colors) +
  theme(legend.position = "none")

pca_trigram_res2[["x"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = PC1, y = PC2, color = dataset)) +
  geom_point(alpha = 0.5) +
  scale_color_manual("Data set", values = colors) +
  theme_bw()
pca_trigram_res2[["x"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = PC1, y = PC2, color = dataset)) +
  geom_point(alpha = 0.5) +
  facet_wrap(~dataset) +
  scale_color_manual("Data set", values = colors) +
  theme_bw() +
  theme(legend.position = "none")
```

### t-SNE
Perplexity = 10
```{r}
tsne_trigrams_res1 <- tsne(trigrams_amyloids_both, k = 2, perplexity = 10, max_iter = 1000)
mutate(as.data.frame(tsne_trigrams_res1), dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

tsne_trigrams_res2 <- tsne(trigrams_amyloids_combined, k = 2, perplexity = 10, max_iter = 1000)
mutate(as.data.frame(tsne_trigrams_res2), dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Perplexity = 15
```{r}
tsne_trigrams_res1 <- tsne(trigrams_amyloids_both, k = 2, perplexity = 15, max_iter = 1000)
mutate(as.data.frame(tsne_trigrams_res1), dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

tsne_trigrams_res2 <- tsne(trigrams_amyloids_combined, k = 2, perplexity = 15, max_iter = 1000)
mutate(as.data.frame(tsne_trigrams_res2), dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Perplexity = 30
```{r}
tsne_trigrams_res1 <- tsne(trigrams_amyloids_both, k = 2, perplexity = 30, max_iter = 1000)
mutate(as.data.frame(tsne_trigrams_res1), dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

tsne_trigrams_res2 <- tsne(trigrams_amyloids_combined, k = 2, perplexity = 30, max_iter = 1000)
mutate(as.data.frame(tsne_trigrams_res2), dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Perplexity = 15, k = 5
```{r}
tsne_trigrams_res1 <- tsne(trigrams_amyloids_both, k = 5, perplexity = 15, max_iter = 1000)
mutate(as.data.frame(tsne_trigrams_res1), dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

tsne_trigrams_res2 <- tsne(trigrams_amyloids_combined, k = 5, perplexity = 15, max_iter = 1000)
mutate(as.data.frame(tsne_trigrams_res2), dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point(size = 2) +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

### UMAP

Neighbors = 15, spread = 2, min_dist = 0.5
```{r}
umap_config <- umap.defaults
umap_config[["random_state"]] <- 73607254
umap_config[["spread"]] <- 2
umap_config[["min_dist"]] <- 0.5

umap_res1 <- umap(trigrams_amyloids_both, config = umap_config)
umap_res1[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

umap_res2 <- umap(trigrams_amyloids_combined, config = umap_config)
umap_res2[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Neighbors = 15, spread = 1, min_dist = 0.5
```{r}
umap_config <- umap.defaults
umap_config[["random_state"]] <- 73607254
umap_config[["spread"]] <- 1
umap_config[["min_dist"]] <- 0.5

umap_res1 <- umap(trigrams_amyloids_both, config = umap_config)
umap_res1[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

umap_res1[["layout"]] %>% 
            as.data.frame() %>% 
            mutate(dataset = filtered_datasets_amyloids_both,
                   name = unlist(sapply(names(datasets_list_amyloids_both), function(i) names(datasets_list_amyloids_both[[i]]), USE.NAMES = FALSE))) %>% 
    plot_ly(x = ~V1, y = ~V2, color = ~dataset, colors = colors, text = ~name, hoverinfo = "text")

umap_res2 <- umap(trigrams_amyloids_combined, config = umap_config)
umap_res2[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Neighbors = 30, spread = 1, min_dist = 0.5
```{r}
umap_config <- umap.defaults
umap_config[["random_state"]] <- 73607254
umap_config[["spread"]] <- 1
umap_config[["min_dist"]] <- 0.5
umap_config[["n_neighbors"]] <- 30

umap_res1 <- umap(trigrams_amyloids_both, config = umap_config)
umap_res1[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

umap_res2 <- umap(trigrams_amyloids_combined, config = umap_config)
umap_res2[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```

Neighbors = 50, spread = 1, min_dist = 0.5
```{r}
umap_config <- umap.defaults
umap_config[["random_state"]] <- 73607254
umap_config[["spread"]] <- 1
umap_config[["min_dist"]] <- 0.5
umap_config[["n_neighbors"]] <- 50

umap_res1 <- umap(trigrams_amyloids_both, config = umap_config)
umap_res1[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_both) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()

umap_res2 <- umap(trigrams_amyloids_combined, config = umap_config)
umap_res2[["layout"]] %>% 
  as.data.frame() %>% 
  mutate(dataset = filtered_datasets_amyloids_combined) %>% 
  ggplot(aes(x = V1, y = V2, color = dataset)) +
  geom_point() +
  scale_color_manual("Data set", values = colors) + 
  theme_bw()
```
